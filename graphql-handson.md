# GraphQLハンズオン

## GraphQLとは何か

- APIを叩くためのクエリ言語の仕様
- スキーマという、バックエンドが「何をどのような形で」「受け取り、返すのか」という仕様を通じて、フロントエンドとバックエンドが会話する
```
type Query {
  hello(name: String): String
}
type Mutation {
  updateName(newName: String): String
}
```
- オブジェクトのキーだけを羅列するようなフォーマットによって、欲しい情報をピンポイントで取得できる
- なので、RESTとは異なりAPIのエンドポイントは原則として一つだけとなる
- GraphQL自体はあくまで仕様であり、実装は任せられている。ApolloやRelayなどのライブラリはJavaScriptにおける代表的な実装である。

## Reactアプリで使う場合、RESTと比べて何が嬉しいのか

- 必要なデータだけを一発で取ってくることができる
  - RESTの場合、APIから返ってくるデータは実際に欲しかったデータに対して、多すぎたり少なすぎたりする。
    そのため、場合によっては 複数のエンドポイントにリクエストを投げ、それを加工してRedux等のSingle
    Source Of Truthに保管し、ようやく本当に使いたい箇所で使う、という流れになる。
  - GraphQLの場合、欲しいデータだけを一回のリクエストで取得することができる。Apollo Clientの場合
    データの取得は宣言的であるため、GraphQLというエンドポイントそのものがSSOTのように振る舞うことに
    なる。これが、Apollo Clientを使うなら大抵の場合Reduxは不要になる、と言われる理由でもある。
- 取得するデータ全てに型がついている
  - スキーマにおける値には全て型が付いている。そのため、その型をTypeScriptで使用するツールを使えば、サーバーから返される値を静的にチェックしながら実装することができる。
- 簡単に使えるPlaygroundと正確なドキュメントで、APIを秒速で理解することができる
  - スキーマがあればエンドポイントに対して何を投げられるのか、返ってくる値の型はなんなのか、などがわかるため、補完機能とドキュメント付きのPlaygroundを（ライブラリ側が）作ることが可能となった。Apollo ServerにはこのPlaygroundがあるため、開発に非常に役立つ。
- バージョニングが不要
  - RESTにおいて、あるエンドポイントから返されるデータに突然新たに何かを付け足したりすれば、それを使う側で予期しない動作を引き起こす可能性がある。そのためURLでバージョンを管理することが行われる。
  - GraphQLではそもそも欲しいデータをクライアントが指定しているので、あるクエリから返されるデータに何かを付け足しても、それを使う側に破壊的な影響を与えない。また、廃止したいクエリやプロパティについてdeprecateであることを伝えることもできる。
